# JSON Web Token
jwt는 웹표준으로서 두 개체에서 json객체를 사용해 가볍고 자가수용적인 방식으로 정보를 안전하게 전달해준다.

> 자가 수용적인(self-contained) 방식이란 필요한 모든 정보를 자체적으로 지니고있다는 말이다. jwt를 통해 발급된 토큰의 형태는, 토큰에 대한 **기본** 정보가 무엇인지, **전달**할 정보가 무엇인지, 이 토큰이 **검증되었다는** signature를 포함하는것을 떠올리며 이해하자.

자가 수용적인 형태를 띄고있다는 말은 전달과정이 손쉽게 행해 질수 있다는 점도 내포한다. 

웹서버의 경우 HTTP 헤더에 넣어 전달하는 형태이며, URL의 파라미터로도 전달할 수 있다는 점이 특징이다.

## 어떤 상황에서 사용되는지

#### 회원인증 절차

회원인증에서 가장 흔하게 사용된다. 유저가 로그인을 하면, 서버는 유저의 정보에 기반한 토큰을 발급해 유저에게 전달해준다. (jwt는 없는상태)

이 후 유저가 서버에 요청을 할때마다 jwt를 포함해 전달하는 방법으로 인증과정이 진행되는것이다.

클러이언트가 서버에게 요청할때마다, 앞서 전달된 토큰이 유효한지, 인증이 되어있는지를 검증하고 요청된 request에 권한이 있는 지를 체크하는것이다.

이러한 방식으로 서버측에서는 유저의 세션을 유지할 필요가 없어지며, 유저의 로그인 여부에 신경쓸 필요없는 것이다.

따라서 유저가 요청했을때 토큰을 확인하는 작업만을 수행하게되는것으로 세션관리가 필요없어지기 때문에 서버자원도 아낄수있다.


#### 정보 교류
jwt는 두 개체사이에 안정성있게 정보를 교환하기에 좋은방법이다.

토큰에 signature를 포함시킨다는 점은 보낸이가 누구인지에 관해 보장해주며, 도중에 조작되어있지는 않은지 검증 할 수 있다.

## 토큰의 형태
![jwt](https://velopert.com/wp-content/uploads/2016/12/jwt.png)
출처 : [JWT JSON Web Token 소개 및 구조](https://velopert.com/wp-content/uploads/2016/12/jwt.png)

### Header
- `typ` : 토큰의 타입을 지정한다. (jwt)
- `alg` : 해싱 알고리즘을 지정한다. 보통 `HMAC SHA256` 혹은 `RSA`가 사용된다. 토큰을 검증할때 사용되는 `signature` 부분에서 사용된다.

### Payload (정보)
토큰에 담을 정보 그 자체를 의미한다. payload에 담는 정보의 한 '조각'을 클레임이라 부르고, 이는 `name/value`의 한쌍을 이룬다. (클레임들의 모음이 페이로드.)

- 클레임의 종류
    - **등록된(registered)** 클레임
    - **공개(public)** 클레임
    - **비공개(private)** 클레임

#### 등록된(registered) 클레임
서비스에서 필요한 정보가 아닌, 토큰에 대한 메타데이터를 담기위한것으로 이름들이 이미 정해져있다.

등록된 클레임의 사용은 모두 optional하다.

- `iss` : 토큰 발급자 (issuer)
- `sub` : 토큰 제목 (subject)
- `aud` : 토큰 대상자 (audience)
- `exp` : 토큰의 만료시간, 시간은 NumbericDate형식으로 현재시간보다 이후로 설정되어야 한다.
- `nbf` : Not Before를 의미하며, 토큰의 활성 날짜와 비슷한 개념. 여기도 NumbericDate 형식으로 날짜를 지정하며, 이 시간 전까지는 토큰이 처리되지않는다. *(보증기간의 시작점? 으로 이해하자)*
- `iat` : 토큰이 발급된 시간(issued at), 이 값을 사용해 토큰의 age를 판별할 수 있다.
- `jti` : jwt의 고유 식별자로 사용되며 중복처리를 위한 경우에 사용된다. ( 일회용 토큰에 사용하면 유용하다고 한다.)

#### 공개(public) 클레임
공개 클레임들은 충돌이 방지된 이름을 가지고 있어야한다. 충돌을 방지하기 위해 url형식으로 짓는다.
```json
{
    "https://jihunhong.github.io/jwt_claims/is_admin": true
}
```

#### 비공개(private) 클레임
두 개체사이에 협의하에 사용되는 클레임 이름이다. 이름이 중복되어 충돌 될 수 있으니 유의하자.

```json
{
    "username": "jihunhong"
}
```

#### 서명(signature)
서명은 헤더의 인코딩값과 정보의 인코딩값을 합친후 주어진 비밀키로 해쉬를 통해 생성한다.

헤더와 정보의 인코딩 값 사이에 `.`을 넣어주고 합친 문자열에

주어진 secret값으로 해싱후 base64로 인코딩하는것이다.

##### :books: reference
[https://velopert.com/2389](https://velopert.com/2389)
[https://jwt.io/](https://jwt.io/)